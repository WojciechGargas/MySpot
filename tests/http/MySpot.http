@url = http://localhost:5223
@parkingSpotId = 00000000-0000-0000-0000-000000000001
@date = 2026-02-18
@userSeed = {{$randomInt}}


###
POST {{url}}/users
Content-Type: application/json

{
    "email": "user{{userSeed}}@myspot.io",
    "username": "user{{userSeed}}",
    "password": "secret",
    "fullName": "John Doe",
    "role": "user"
}

###
GET {{url}}

###
GET {{url}}/parking-spots

> {%
    const spots = Array.isArray(response.body) ? response.body : [];
    const reservations = spots.flatMap(s => Array.isArray(s.reservations) ? s.reservations : []);
    const baseUrl = (request.environment && request.environment.get("url")) || "{{url}}";
    client.global.set("baseUrl", baseUrl);
    client.global.set("reservationIds", reservations.map(r => r.id));
    if (reservations.length > 0) {
        client.global.set("reservationId", reservations[0].id);
    } else {
        client.global.clear("reservationId");
    }
%}

###
POST {{url}}/parking-spots/{{parkingSpotId}}/reservations/vehicle
Content-Type: application/json

{
  "ParkingSpotId": "{{parkingSpotId}}",
  "ReservationId": "00000000-0000-0000-0000-000000000010",
  "Capacity": 4,
  "EmployeeName": "John Doe",
  "LicensePlate": "XYZ123",
  "Date": "{{date}}"
}

###
POST {{url}}/parking-spots/reservations/cleaning
Content-Type: application/json

{
  "Date": "{{date}}"
}

###
PUT {{url}}/parking-spots/reservations/{{reservationId}}
Content-Type: application/json

{
  "LicensePlate": "XYZ124"
}

###
DELETE {{url}}/parking-spots/reservations/{{reservationId}}
