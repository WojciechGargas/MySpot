@url = http://localhost:5223
@parkingSpotId = 00000000-0000-0000-0000-000000000001
@date = 2026-02-18
@userSeed = {{$randomInt}}
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI3ZTcxZDcwNi0zNWE0LTRlY2UtOGMwMy1lZWYyM2NiNzlkMmMiLCJ1bmlxdWVfbmFtZSI6IjdlNzFkNzA2LTM1YTQtNGVjZS04YzAzLWVlZjIzY2I3OWQyYyIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6InVzZXIiLCJuYmYiOjE3NzE0MDQ0ODMsImV4cCI6MTc3MTQwODA4MywiaXNzIjoibXlzcG90LWlzc3VlciIsImF1ZCI6Im15c3BvdC1hdWRpZW5jZSJ9.tKkECLes2qh2cXDccKrpsmsnt0-WWwUW4qU_R_lh4yE


###
GET{{url}}/users/jwt

###
GET{{url}}/users/me

###
GET{{url}}/users/me
Authorization: Bearer {{accessToken}}

###
POST {{url}}/users
Content-Type: application/json

{
    "email": "user2@myspot.io",
    "username": "user2",
    "password": "secret",
    "fullName": "John Doe",
    "role": "user"
}

###
#@name sign_in
POST {{url}}/users/sign-in
Content-Type: application/json

{
    "email": "user2@myspot.io",
    "password": "secret"
}

###
GET {{url}}

###
GET {{url}}/parking-spots

> {%
    const spots = Array.isArray(response.body) ? response.body : [];
    const reservations = spots.flatMap(s => Array.isArray(s.reservations) ? s.reservations : []);
    const baseUrl = (request.environment && request.environment.get("url")) || "{{url}}";
    client.global.set("baseUrl", baseUrl);
    client.global.set("reservationIds", reservations.map(r => r.id));
    if (reservations.length > 0) {
        client.global.set("reservationId", reservations[0].id);
    } else {
        client.global.clear("reservationId");
    }
%}

###
POST {{url}}/parking-spots/{{parkingSpotId}}/reservations/vehicle
Content-Type: application/json

{
  "ParkingSpotId": "{{parkingSpotId}}",
  "ReservationId": "00000000-0000-0000-0000-000000000010",
  "Capacity": 4,
  "EmployeeName": "John Doe",
  "LicensePlate": "XYZ123",
  "Date": "{{date}}"
}

###
POST {{url}}/parking-spots/reservations/cleaning
Content-Type: application/json

{
  "Date": "{{date}}"
}

###
PUT {{url}}/parking-spots/reservations/{{reservationId}}
Content-Type: application/json

{
  "LicensePlate": "XYZ124"
}

###
DELETE {{url}}/parking-spots/reservations/{{reservationId}}
