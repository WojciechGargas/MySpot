# Scenario: debug cleanup for reservations.
# Options:
# - Manual: delete the first reservation (repeat as needed).
# - Auto: delete all reservations in a loop.

@url = http://localhost:5223

### Step 1: List reservations and capture ids
GET {{url}}/parking-spots

> {%
    const spots = Array.isArray(response.body) ? response.body : [];
    const reservations = spots.flatMap(s => Array.isArray(s.reservations) ? s.reservations : []);
    if (reservations.length > 0) {
        client.global.set("firstReservationId", reservations[0].id);
    } else {
        client.global.clear("firstReservationId");
    }
    client.global.set(
        "reservationIds",
        reservations.map((r) => r.id)
    );
%}

### Step 2 (manual): Delete the first reservation
# Run this step repeatedly to clear the database by hand.
DELETE {{url}}/parking-spots/reservations/{{firstReservationId}}

### Step 3 (auto): Delete all reservations from the latest list
# Run Step 1 first (or Run All). The HTTP client will iterate over {{reservationIds}}.
DELETE {{url}}/parking-spots/reservations/{{reservationIds}}
